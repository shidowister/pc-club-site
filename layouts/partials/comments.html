<script src="https://giscus.app/client.js"
        data-repo="shidowister/ist-md-pc-club-site"
        data-repo-id="R_kgDOQg0ojg"
        data-category="General"
        data-category-id="DIC_kwDOQg0ojs4C0htG"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light" 
        data-lang="ja"
        crossorigin="anonymous"
        async>
</script>

<script>
    // Giscusのテーマを強制的に合わせる関数
    function syncGiscusTheme() {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;

        // PaperModの現在の状態（bodyにdarkクラスがあるか）で判定
        const isDark = document.body.classList.contains('dark');
        const theme = isDark ? 'dark' : 'light';

        // Giscusに命令を送信
        iframe.contentWindow.postMessage({
            giscus: {
                setConfig: {
                    theme: theme
                }
            }
        }, 'https://giscus.app');
    }

    // 1. 【監視カメラ】bodyのクラス変更を常時監視する
    // これにより、ボタンを押した瞬間確実に反応します
    const observer = new MutationObserver(syncGiscusTheme);
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });

    // 2. 【初期化】Giscusが読み込まれたタイミングで現在の色を適用する
    window.addEventListener('message', function (event) {
        if (event.origin === 'https://giscus.app' && event.data.giscus) {
            syncGiscusTheme();
        }
    });
</script>