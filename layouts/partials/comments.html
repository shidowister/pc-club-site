<div class="giscus"></div>

<script>
    // 1. 設定情報（ここは変更しないでください）
    const giscusConfig = {
        repo: "shidowister/ist-md-pc-club-site",
        repoId: "R_kgDOQg0ojg",
        category: "General",
        categoryId: "DIC_kwDOQg0ojs4C0htG",
        mapping: "title",
        reactionsEnabled: "1",
        emitMetadata: "0",
        inputPosition: "bottom",
        lang: "ja",
    };

    // 2. 現在のテーマ（DarkかLightか）を判定する関数
    function getCurrentTheme() {
        return document.body.classList.contains('dark') ? 'dark' : 'light';
    }

    // 3. ページ読み込み時に、正しい設定でGiscusを生成して埋め込む
    //    これなら最初から正しい色で表示されます！
    const giscusScript = document.createElement("script");
    giscusScript.src = "https://giscus.app/client.js";
    giscusScript.setAttribute("data-repo", giscusConfig.repo);
    giscusScript.setAttribute("data-repo-id", giscusConfig.repoId);
    giscusScript.setAttribute("data-category", giscusConfig.category);
    giscusScript.setAttribute("data-category-id", giscusConfig.categoryId);
    giscusScript.setAttribute("data-mapping", giscusConfig.mapping);
    giscusScript.setAttribute("data-reactions-enabled", giscusConfig.reactionsEnabled);
    giscusScript.setAttribute("data-emit-metadata", giscusConfig.emitMetadata);
    giscusScript.setAttribute("data-input-position", giscusConfig.inputPosition);
    giscusScript.setAttribute("data-lang", giscusConfig.lang);
    giscusScript.setAttribute("data-theme", getCurrentTheme()); // ★ここで現在の色をセット
    giscusScript.crossOrigin = "anonymous";
    giscusScript.async = true;
    
    // 箱の中にスクリプトを入れる
    document.querySelector(".giscus").appendChild(giscusScript);


    // 4. その後、テーマ切り替えボタンが押された時の対策（監視カメラ）
    const observer = new MutationObserver(function() {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        
        // テーマが変わったらGiscusに通知
        const newTheme = getCurrentTheme();
        iframe.contentWindow.postMessage({
            giscus: {
                setConfig: {
                    theme: newTheme
                }
            }
        }, 'https://giscus.app');
    });
    
    // 監視開始
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
</script>